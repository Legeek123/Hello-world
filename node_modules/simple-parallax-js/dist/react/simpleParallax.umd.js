(function(t,c){typeof exports=="object"&&typeof module<"u"?module.exports=c(require("react")):typeof define=="function"&&define.amd?define(["react"],c):(t=typeof globalThis<"u"?globalThis:t||self,t.MyReactLibrary=c(t.React))})(this,function(t){"use strict";class c{constructor(){this.callbacks=new Set,this.animationFrameId=null}static getInstance(){return c.instance||(c.instance=new c),c.instance}register(n){this.callbacks.add(n),this.animationFrameId===null&&this.start()}unregister(n){this.callbacks.delete(n),this.callbacks.size===0&&this.animationFrameId!==null&&this.stop()}start(){const n=()=>{this.callbacks.forEach(s=>s()),this.animationFrameId=requestAnimationFrame(n)};this.animationFrameId=requestAnimationFrame(n)}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}const E=c.getInstance(),F=e=>{const[n,s]=t.useState(0),[a,o]=t.useState(!1),i=t.useRef(null),r=t.useCallback(()=>{i.current&&s(i.current.height)},[]);return t.useEffect(()=>{const f=()=>{o(!0),r()},u=i.current;return u&&(u.complete?f():u.addEventListener("load",f)),window.addEventListener("resize",r),()=>{u&&u.removeEventListener("load",f),window.removeEventListener("resize",r)}},[e,r]),[i,n,a]},v=(e,n)=>e*n-e,k=(e,n)=>Math.ceil(e/100*n-n/2),C=(e,n)=>{const{top:s,height:a}=e,o=-a,i=n;if(s<o)return 0;if(s>i)return 100;const r=(s-o)/(i-o)*100;return Math.min(Math.max(r,0),100)},H=(e,n)=>{switch(n){case"up":return`0, ${e}px, 0`;case"right":return`${-e}px, 0, 0`;case"down":return`0, ${-e}px, 0`;case"left":return`${e}px, 0, 0`;case"up left":return`${e}px, ${e}px, 0`;case"up right":return`${-e}px, ${e}px, 0`;case"down left":return`${e}px, ${-e}px, 0`;case"left right":return`${-e}px, ${-e}px, 0`;default:return`0, ${e}px, 0`}},T=()=>{const[e,n]=t.useState(null);return t.useEffect(()=>{const s=()=>{n(window.innerHeight)};if(typeof window<"u")return n(window.innerHeight),window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),e},L=({isLoaded:e,imageHeight:n,scale:s,boundingClientRect:a,orientation:o,maxTransition:i})=>{const[r,f]=t.useState(0),[u,h]=t.useState(0),[d,w]=t.useState(""),[p,b]=t.useState(0),g=T();return t.useEffect(()=>{if(!e)return;const l=v(n,s);f(l)},[e,n,s]),t.useEffect(()=>{if(!e||!g||!a)return;let l=C(a,g);i&&(l=Math.min(l,100-i)),b(l)},[e,a,g]),t.useEffect(()=>{const l=k(p,r);h(l)},[p,r]),t.useEffect(()=>{const l=H(u,o);w(l)},[u,o]),d},P=(e={})=>{const[n,s]=t.useState(!1),a=t.useRef(null);return t.useEffect(()=>{const o=new IntersectionObserver(r=>{const[f]=r;f&&(f.isIntersecting?s(!0):s(!1))},{...e}),{current:i}=a;return i&&o.observe(i),()=>{i&&o.unobserve(i)}},[e]),[a,n]};var z="/Users/geoffrey/Desktop/perso/simpleParallax.js/src/react/index.tsx";return({delay:e=.4,orientation:n="up",scale:s=1.4,overflow:a=!1,transition:o="cubic-bezier(0,0,0,1)",maxTransition:i=null,children:r})=>{var y;const f=n??"up",u=s??1.2,h=(y=r==null?void 0:r.props)==null?void 0:y.src,[d,w]=t.useState(!1),[p,b]=t.useState(0),[g,l]=t.useState(null),[M,N]=t.useState(""),[j,q]=t.useState(""),[x,A,B]=F(h),[G,I]=P({root:null,rootMargin:"0px",threshold:Array.from(Array(101).keys(),m=>m/100)}),$=L({isLoaded:B,imageHeight:A,scale:u,boundingClientRect:g,orientation:f,maxTransition:i}),S=t.useCallback(()=>{var m;if(!(!I&&d)&&(window.scrollY!==p||!d)){const V=(m=x.current)==null?void 0:m.getBoundingClientRect();V&&l(V),d||w(!0),b(window.scrollY)}},[p,I,x]);t.useEffect(()=>{let m=`translate3d(${$})`;a||(m+=` scale(${u})`),N(m)},[$,u]),t.useEffect(()=>{!o||!e||q(`transform ${e}s ${o}`)},[o,e]),t.useEffect(()=>(E.register(S),()=>{E.unregister(S)}),[S]);const O=t.isValidElement(r)?t.cloneElement(r,{style:{...r.props.style??{},transform:M,willChange:"transform",transition:j},ref:x}):null;return t.createElement("div",{ref:G,style:{display:"inline-block",overflow:a?"visible":"hidden",width:"100%",height:"100%"},__self:void 0,__source:{fileName:z,lineNumber:92,columnNumber:5}},O)}});
